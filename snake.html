<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="Nolan Jannotta" />
    <title>Nolan Jannotta</title>
    <link rel="icon" href="./icon.svg" type="image/svg+xml">
    <link href="./style.css" rel="stylesheet" />
  </head>

<body>
    <header>
        <h1 class="title">Nolan Jannotta</h1>

        <nav>
            <ul class="nav_bar">
                <li><a href="https://personal-site-neon-ten.vercel.app/index.html">&#8656; home</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="about">
            <h1>&#9711; Snake</h1>
            <figure>
                  <p> <small id="deployedAt">&#9657; deployed: <a href="https://etherscan.io/tx/0x12e0cd7ae8cccd34ab201dfce8dde6092f478932c3383885594ad30ab6f68fbb" target="_blank">May-05-2022</a></small> &nbsp; <small id="vintageScore"></small></p>  
                    <p> <small>&#9657; mainnet</small></p>                  
            </figure>

            <span class="corners">
                <span>&#8988;</span>
                <span>&#8989;</span>
              </span>
            
            <p>a fully onchain game of snake. Fully functioning SVG stored onchain. comes in 5 colors schemes.</p>
            <p>&#10036;<b> known bug:</b> food is able to spawn underneath the snake. &#10036;</p>
            <span class="corners">
                <span>&#8990;</span>
                <span>&#8991;</span>
              </span>

        </section>

        <section id="portfolio">
            
            <object width="500" id="image"></object>
            <p id="supply">loading...</p>
        </section>
        
        <section id="contact">
        <span id="connectButtons">
           <button id="metamask">metamask</button>
            <button id="coinbaseWallet">coinbaseWallet</button> 
        </span>
        

        <span class="mintButtons" id="mintButtons">
            <p > <small id="account"></small> <small><button id="disconnect">disconnect</button>  
            </small></p>
            <p > <small id="balance"></small></p>

                <span class="controls">
                    <p class="inputButtons">&#12308;-&#12309;</p>
                    <span>4</span>
                    <p class="inputButtons">&#12308;+&#12309;</p>
                
                </span>
            <span>
                <button id="mint">mint</button>
            </span>
            
        </span>
        </section>
    </main>

    <footer>
        <p><small>made with â˜  by nolan</small></p>
    </footer>
</body>

<script type="module">
    import { createPublicClient, http, getContract, formatEther,parseEther  } from 'https://esm.sh/viem'
    import { mainnet } from 'https://esm.sh/viem/chains'
    import { createConfig, readContracts, connect, disconnect, getAccount,simulateContract, writeContract,getBalance  } from 'https://esm.sh/@wagmi/core@2.x'
    import { injected, metaMask,coinbaseWallet  } from 'https://esm.sh/@wagmi/connectors'

    const image = document.getElementById('image');
    const supply = document.getElementById('supply');
    const metamask = document.getElementById('metamask');
    const coinbaseWalletElement = document.getElementById('coinbaseWallet');
    const disconnectElement = document.getElementById('disconnect');
    const accountElement = document.getElementById('account');
    const connectButtons = document.getElementById('connectButtons');
    const mintButtons = document.getElementById('mintButtons');
    const inputArray = document.getElementById('inputArray');
    const vintageScore = document.getElementById('vintageScore');

    console.log(document.location.origin)
    const snakeAddress = "0x8c822FA282722eDcA512A9E94C591d3F52196eF2"
    const abi = [{
        inputs: [
            {
                "internalType": "uint256",
                "name": "id",
                "type": "uint256"
            }
        ],
        name: "tokenURI",
        outputs: [
            {
                internalType: "string",
                name: "",
                type: "string"
            }
        ],
        stateMutability: "view",
        type: "function"
    },
    {
        inputs: [],
        name: "totalSupply",
        outputs: [
            {
                internalType: "uint256",
                name: "",
                type: "uint256"
            }
        ],
        stateMutability: "view",
        type: "function"
    },
    {
        inputs: [],
        name: "maxSupply",
        outputs: [
            {
                internalType: "uint256",
                name: "",
                type: "uint256"
            }
        ],
        stateMutability: "view",
        type: "function"
    },
    {
        inputs: [],
        name: "price",
        outputs: [
            {
                internalType: "uint256",
                name: "",
                type: "uint256"
            }
        ],
        stateMutability: "view",
        type: "function"
    },
    {
        inputs: [
            {
                internalType: "uint256[]",
                name: "schemeIds",
                type: "uint256[]"
            }
        ],
        name: "buySnake",
        outputs: [],
        stateMutability: "payable",
        type: "function"
    },

    ]

    const config = createConfig({
        chains: [mainnet],
        transports: {
            [mainnet.id]: http("https://rpc.flashbots.net")
        }

    })


    // async function getAddress() {
    //     return await getAccount(config)
    //     console.log(address)
    // }


    async function createInputArray(e) {
        console.log(e)
        const inputArr = []
        for(let i = 0; i <Number(e.data); i++) {
            inputArr.push(BigInt(Math.floor((Math.random() * 5)+1)))

        }
        console.log(inputArr)
        const account = await getAccount(config)

        // const { request } = await simulateContract(config, {
        //     address: snakeAddress,
        //     abi,
        //     functionName: 'buySnake',
        //     args: [inputArr],
        //     value: parseEther(".04"),
        //     // account: account.address
        //     })

        //     console.log(request)
        // const hash = await writeContract(config, request)
        return inputArr

        

        // const result = await getContract(config, {
        //         chain: mainnet,
        //         address: snakeAddress,
        //         abi,
        //         functionName: 'mint',
        //         args: [1]

    }

    // console.log(createInputArray(5))

    async function disconnectWallet() {
        await disconnect(config)
        accountElement.textContent = ""
        connectButtons.style.display = "inline"
        mintButtons.style.display = "none"
    }


    async function connectWallet(connector, options = {}) {
        const result = await connect(config, {
            connector: connector(options)
        })
        const balance = await getBalance(config, {address: result.accounts[0]})
        document.getElementById('balance').textContent = `balance: ${balance.formatted} eth`
        accountElement.textContent = `connected as: ${result.accounts[0]}`
        connectButtons.style.display = "none"
        mintButtons.style.display = "inline"


    }



    window.onload = async function () {



        const results = await readContracts(config, {
            contracts: [
                {
                    address: snakeAddress,
                    abi,
                    functionName: 'tokenURI',
                    args: [1]
                },
                {
                    address: snakeAddress,
                    abi,
                    functionName: 'totalSupply',
                },
                {
                    address: snakeAddress,
                    abi,
                    functionName: 'maxSupply',
                },
                {
                    address: snakeAddress,
                    abi,
                    functionName: 'price',
                }
            ]
        })



        const response = await fetch(results[0].result)
        const json = await response.json()

        supply.textContent = `supply: ${Number(results[1].result)}/${Number(results[2].result)} \u2592\u2592\u2592 price: ${formatEther(results[3].result)} eth`
        image.setAttribute('data', json.image)

        metamask.onclick = () => connectWallet(injected)
        coinbaseWalletElement.onclick = () => connectWallet(coinbaseWallet, {appName: 'snake',preference: "all"})
        disconnectElement.onclick = () => disconnectWallet()
        
        // inputArray.oninput = createInputArray

        mintButtons.style.display = "none"

        const address = await getAccount(config)

        const punksAge = Date.now()/1000 -  1496967770;
        const snakeAge = Date.now()/1000 -  1651739467;
        vintageScore.textContent = `vintage score: ${(snakeAge/punksAge * 10).toFixed(2)}`
        vintageScore.style.fontSize = "small"



        // if(address.address) {
        //     accountElement.textContent = `connected as: ${address.address}`
        //     connectButtons.style.display = "none"
        //     mintButtons.style.display = "inline"
        
        // }
        // else {
        //     accountElement.textContent = ""
        //     connectButtons.style.display = "inline"
        //     mintButtons.style.display = "none"
        
        // }


        // accountElement.onclick = getAddress


    };





</script>

</html>