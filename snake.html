<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nolan Jannotta</title>

    <link href="./style.css" rel="stylesheet">



</head>

<body>
    <header>
        <h1 class="title">Nolan Jannotta</h1>

        <nav>
            <ul class="nav_bar">
                <li><a href="https://personal-site-neon-ten.vercel.app/index.html">&#8656; home</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="about">
            <h1>&#9711; Snake</h1>
            <figure>
                  <p> <small id="deployedAt">&#9657; deployed: loading...</small></p>  
                    <p> <small>&#9657; mainnet</small></p>                  
            </figure>
            
            <p>a fully onchain game of snake. Fully functioning SVG stored onchain. comes in 5 colors schemes.</p>
            <p><b>&#10036; known bug:</b> food is able to spawn underneath the snake. &#10036;</p>
            <object width="500" id="image"></object>
            <p id="supply">loading...</p>
        </section>
        <p id="account">account</p>

        <button id="metamask">metamask</button>
        <button id="walletConnect">walletConnect</button>
        <button id="coinbaseWallet">coinbaseWallet</button>
        <button id="disconnect">disconnect</button>
        

    </main>

    <footer>
        <p><small>made with â˜  by nolan</small></p>
    </footer>
</body>

<script type="module">
    import { createPublicClient, http, getContract, formatEther } from 'https://esm.sh/viem'
    import { mainnet } from 'https://esm.sh/viem/chains'
    import { createConfig, readContracts, connect, disconnect, getAccount } from 'https://esm.sh/@wagmi/core@2.x'
    import { injected, metaMask, walletConnect,coinbaseWallet  } from 'https://esm.sh/@wagmi/connectors'


    const image = document.getElementById('image');
    const supply = document.getElementById('supply');
    const metamask = document.getElementById('metamask');
    const walletConnectElement = document.getElementById('walletConnect');
    const coinbaseWalletElement = document.getElementById('coinbaseWallet');
    const disconnectElement = document.getElementById('disconnect');
    const accountElement = document.getElementById('account');
    const deployedAt = document.getElementById('deployedAt').textContent = `\u25B9 deployed: May-05-2022`;
    const calculator = "0x8c822FA282722eDcA512A9E94C591d3F52196eF2"
    const abi = [{
        inputs: [
            {
                "internalType": "uint256",
                "name": "id",
                "type": "uint256"
            }
        ],
        name: "tokenURI",
        outputs: [
            {
                internalType: "string",
                name: "",
                type: "string"
            }
        ],
        stateMutability: "view",
        type: "function"
    },
    {
        inputs: [],
        name: "totalSupply",
        outputs: [
            {
                internalType: "uint256",
                name: "",
                type: "uint256"
            }
        ],
        stateMutability: "view",
        type: "function"
    },
    {
        inputs: [],
        name: "maxSupply",
        outputs: [
            {
                internalType: "uint256",
                name: "",
                type: "uint256"
            }
        ],
        stateMutability: "view",
        type: "function"
    },
    {
        inputs: [],
        name: "price",
        outputs: [
            {
                internalType: "uint256",
                name: "",
                type: "uint256"
            }
        ],
        stateMutability: "view",
        type: "function"
    },

    ]

    const config = createConfig({
        chains: [mainnet],
        transports: {
            [mainnet.id]: http("https://rpc.flashbots.net")
        }

    })


    // async function getAddress() {
    //     return await getAccount(config)
    //     console.log(address)
    // }



    async function disconnectWallet() {
        await disconnect(config)
        accountElement.textContent = ""
    }


    async function connectWallet(connector, options = {}) {
        const result = await connect(config, {
            connector: connector(options)
        })
        const address = await getAccount(config)
        accountElement.textContent = `connected as: ${address.address}`


    }



    window.onload = async function () {

        const results = await readContracts(config, {
            contracts: [
                {
                    address: calculator,
                    abi,
                    functionName: 'tokenURI',
                    args: [1]
                },
                {
                    address: calculator,
                    abi,
                    functionName: 'totalSupply',
                },
                {
                    address: calculator,
                    abi,
                    functionName: 'maxSupply',
                },
                {
                    address: calculator,
                    abi,
                    functionName: 'price',
                }
            ]
        })



        const response = await fetch(results[0].result)
        const json = await response.json()

        // deployedAt.textContent = `\u25B9 deployed: May-05-2022`

        supply.textContent = `supply: ${Number(results[1].result)}/${Number(results[2].result)} \u2592\u2592\u2592 price: ${formatEther(results[3].result)} eth`
        image.setAttribute('data', json.image)

        metamask.onclick = () => connectWallet(injected)
        walletConnectElement.onclick = () => connectWallet(walletConnect)
        coinbaseWalletElement.onclick = () => connectWallet(coinbaseWallet, {appName: 'Nolan Jannotta', appLogoUrl: 'https://personal-site-neon-ten.vercel.app/favicon.ico',preference: "all"})
        disconnectElement.onclick = () => disconnectWallet()
        // accountElement.onclick = getAddress


    };





</script>

</html>