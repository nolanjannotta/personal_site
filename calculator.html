<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nolan Jannotta</title>

    <link href="./style.css" rel="stylesheet">



</head>

<body>
    <header>
        <h1 class="title">Nolan Jannotta</h1>

        <nav>
            <ul class="nav_bar">
                <li><a href="https://personal-site-neon-ten.vercel.app/index.html">&#8656; home</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="about">
            <h1>&#9711; Calculators</h1>
            <figure>
                <p> <small id="deployedAt">&#9657; deployed: loading...</small></p>  
                  <p> <small>&#9657; mainnet</small></p>                  
          </figure>

            <p>a fully onchain "NFT" from 2022. Fully functioning SVG stored onchain. comes in 5 colors. </p>
            <object width="500" id="image"></object>
            <p id="supply">loading...</p>
        </section>

        <button id="connectWallet">connect</button>

    </main>

    <footer>
        <p><small>made with â˜  by nolan</small></p>
    </footer>
</body>

<script type="module">
    import { createPublicClient, http, getContract, formatEther } from 'https://esm.sh/viem'
    import { mainnet } from 'https://esm.sh/viem/chains'
    import { createConfig, readContracts, connect } from 'https://esm.sh/@wagmi/core@2.x'
    import { injected, metaMask, walletConnect } from 'https://esm.sh/@wagmi/connectors'


    const image = document.getElementById('image');
    const supply = document.getElementById('supply');
    const connectButton = document.getElementById('connectWallet');
    const deployedAt = document.getElementById('deployedAt').textContent = `\u25B9 deployed: Mar-30-2022`;



    const calculator = "0xC3B88A12D8Cda6b9802C30be4bb18BDd1828b317"
    const abi = [{
        inputs: [
            {
                "internalType": "uint256",
                "name": "id",
                "type": "uint256"
            }
        ],
        name: "tokenURI",
        outputs: [
            {
                internalType: "string",
                name: "",
                type: "string"
            }
        ],
        stateMutability: "view",
        type: "function"
    },
    {
        inputs: [],
        name: "totalSupply",
        outputs: [
            {
                internalType: "uint256",
                name: "",
                type: "uint256"
            }
        ],
        stateMutability: "view",
        type: "function"
    },
    {
        inputs: [],
        name: "maxSupply",
        outputs: [
            {
                internalType: "uint256",
                name: "",
                type: "uint256"
            }
        ],
        stateMutability: "view",
        type: "function"
    },
    {
        inputs: [],
        name: "price",
        outputs: [
            {
                internalType: "uint256",
                name: "",
                type: "uint256"
            }
        ],
        stateMutability: "view",
        type: "function"
    },

    ]

    const config = createConfig({
        chains: [mainnet],
        transports: {
            [mainnet.id]: http("https://eth.llamarpc.com")
        }

    })





    async function connectWallet() {
        const result = await connect(config, {
            connector: injected({
                target() {
                    return {
                        id: 'windowProvider',
                        name: 'Window Provider',
                        provider: window.ethereum,
                    }
                },
            })
        })
    }


    window.onload = async function () {

        const results = await readContracts(config, {
            contracts: [
                {
                    address: calculator,
                    abi,
                    functionName: 'tokenURI',
                    args: [1]
                },
                {
                    address: calculator,
                    abi,
                    functionName: 'totalSupply',
                },
                {
                    address: calculator,
                    abi,
                    functionName: 'maxSupply',
                },
                {
                    address: calculator,
                    abi,
                    functionName: 'price',
                }
            ]
        })



        const response = await fetch(results[0].result)
        const json = await response.json()

        // deployedAt.textContent = `\u25B9 deployed: Mar-30-2022`


        supply.textContent = `supply: ${Number(results[1].result)}/${Number(results[2].result)} \u2592\u2592\u2592 price: ${formatEther(results[3].result)} eth`
        image.setAttribute('data', json.image)
        connectButton.onclick = connectWallet


    };





</script>

</html>